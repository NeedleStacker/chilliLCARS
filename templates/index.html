<!doctype html>
<html lang="hr">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<title>üå∂Ô∏è Chilli - kontrolna ploƒça</title>
        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}">
        <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}">
        <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16x16.png') }}">
        <link rel="manifest" href="{{ url_for('static', filename='img/site.webmanifest') }}">
		<!-- Bootstrap 5 CDN -->
		
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
		<!-- Chart.js CDN (mora biti prije main.js) -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<!-- Local styles -->
		<!-- LCARS assets -->
		  <link rel="stylesheet" href="{{ url_for('static', filename='lcars/classic.css') }}">
		  <link rel="stylesheet" href="{{ url_for('static', filename='css/chilli-lcars.css') }}">
		  <script defer src="{{ url_for('static', filename='lcars/lcars.js') }}"></script>
	</head>
	<body>
	  <!-- LCARS-style header -->
  <div class="lcars-topbar">
    <div class="lcars-label">CHILLI</div>
    <div class="lcars-sub">Kontrolna ploƒça</div>
  </div>

  <main role="main" class="container">
		<!-- NAVIGACIJSKA TRAKA -->
		<nav class="navbar card mb-3">
			<div class="container-fluid">
				<!-- Lijeva strana: Odabir pozadine -->
				<div class="background-selector d-flex align-items-center gap-2">
					<input type="file" id="bgImageFiles" class="form-control form-control-sm" accept="image/*" multiple>
					<button id="btnPrevBg" class="btn btn-sm btn-outline-secondary">‚Äπ</button>
					<button id="btnNextBg" class="btn btn-sm btn-outline-secondary">‚Ä∫</button>
                    <button id="btnInfoBg" class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="Nema odabranih slika">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.055.491.206.556.388.062.182.028.37-.082.528a1.001 1.001 0 0 0-.232.386c-.05.18-.087.354-.087.528l.287.082c.326.095.63.194.885.343.254.148.45.333.595.552a1.001 1.001 0 0 1 .05.708c-.028.182-.087.354-.175.528-.088.174-.21.326-.36.465a1.001 1.001 0 0 1-.527.266c-.18.028-.353.028-.527-.002a1.001 1.001 0 0 1-.465-.175c-.148-.124-.27-.294-.36-.491l-.287-.082c-.095-.254-.194-.45-.343-.595a1.001 1.001 0 0 1-.343-.885c-.002-.18.028-.353.087-.527.058-.175.148-.327.265-.465.117-.138.266-.24.43-.306.164-.065.34-.095.528-.095.18 0 .353.03.527.088.175.058.327.148.465.265l.082-.287c.095-.326.194-.63.343-.885a1.001 1.001 0 0 1 .595-.595c.18-.088.353-.148.528-.175l.082-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                        </svg>
                    </button>
					<button id="btnClearBg" class="btn btn-sm btn-outline-secondary">Ukloni</button>
				</div>

				<!-- Desna strana: Mijenjanje teme -->
				<div class="theme-switcher d-flex align-items-center gap-2">
					<label for="theme-select" class="form-label mb-0 small">Tema:</label>
					<select id="theme-select" class="form-select form-select-sm">
						<option value="light">‚òÄÔ∏è Light</option>
						<option value="dark">üåë Dark</option>
						<option value="autumn">üçÇ Autumn</option>
						<option value="winter">‚ùÑÔ∏è Winter</option>
					</select>
				</div>
			</div>
		</nav>

		<div class="container-fluid mt-2">
			<!-- GRAF -->
			<div id="chart-wrap" style="display: flex; flex-direction: column; gap: 10px;">
				<!-- GORNJI RED: Air Temp + Soil Temp (lijevo), Lux (desno) -->
				<div style="display: flex; gap: 10px;">
					<div style="flex: 2;">
						<canvas id="tempChart" style="height: 200px;"></canvas>
					</div>
					<div style="flex: 2;">
						<canvas id="luxChart" style="height: 200px;"></canvas>
					</div>
				</div>
				<!-- DONJI RED: Air Humidity (lijevo), Soil % (desno) -->
				<div style="display: flex; gap: 10px;">
					<div style="flex: 2;">
						<canvas id="humChart" style="height: 200px;"></canvas>
					</div>
					<div style="flex: 2;">
						<canvas id="soilChart" style="height: 200px;"></canvas>
					</div>
				</div>
			</div>
			<div class="row">
				<!-- Tablica -->
				<div class="col-md-5 left-table">
					<div class="row align-items-center mb-3">
						<!-- Brisanje podataka -->
						<div class="col-md-12">
							<h5 class="mb-2">Brisanje podataka</h5>
							<div class="input-group mb-2">
								<input id="deleteIdsInput" type="text" class="form-control" placeholder="ID-evi npr: 1,2,3 ili 'all'">
								<button class="btn btn-danger" id="btnDeleteRows">Obri≈°i</button>
							</div>
							<div id="deleteStatus" class="text-muted small"></div>
						</div>
					</div>
					<div class="d-flex justify-content-between align-items-center">
						<h5>Posljednjih 100 mjerenja</h5>
					</div>
					<table class="table table-sm table-striped">
						<thead class="table-light">
							<tr>
								<th>ID</th>
								<th>Vrijeme</th>
								<th>Air T</th>
								<th>Air H</th>
								<th>Soil T</th>
								<th>Soil %</th>
								<th>Lux</th>
							</tr>
						</thead>
						<tbody id="logsBody"> {% for r in logs %} <tr class="{{ 'unstable' if r.stable == 0 else '' }}">
								<td>{{ r.id }}</td>
								<td>{{ r.timestamp }}</td>
								<td>{{ r.air_temp }}</td>
								<td>{{ r.air_humidity }}</td>
								<td>{{ r.soil_temp }}</td>
								<td>{{ r.soil_percent }}</td>
								<td>{{ r.lux }}</td>
							</tr> {% endfor %} </tbody>
					</table>
				</div>
				<!-- Kontrola -->
				<div class="col-md-7">
					<div class="card p-3 mb-3">
						<div class="row">
							<div class="col-md-6">
								<h5 class="mb-2">Logger kontrola</h5>
								<div class="d-flex gap-2 mb-2">
									<button id="btnStartFirst" class="btn btn-success">START</button>
									<button id="btnStop" class="btn btn-danger">STOP</button>
								</div>
								<p>
									<span id="loggerStatus" class="fw-bold"></span>
								</p>
							</div>
							<div class="col-md-6">
								<h5 class="mb-2">Relay kontrola</h5>
								<div class="d-flex gap-2 mb-2">
									<button id="btn-relay1" class="btn btn-warning">RELAY 1</button>
									<button id="btn-relay2" class="btn btn-info">RELAY 2</button>
								</div>
								<p class="mb-2">
                                    <span class="relay-1-text">Relay 1 (<span id="relay1State">{{ 'ON' if relay1 else 'OFF' }}</span>)</span>,
                                    <span class="relay-2-text">Relay 2 (<span id="relay2State">{{ 'ON' if relay2 else 'OFF' }}</span>)</span>
								</p>
							</div>
						</div>
					</div>
					<table id="relayLogTable" class="table table-sm table-striped table-bordered text-center">
						<thead>
							<tr>
								<th>Vrijeme</th>
								<th>Relej</th>
								<th>Akcija</th>
								<th>Izvor</th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
					<div class="card p-3">
						<h5 class="mb-2">Oƒçitavanje senzora</h5>
						<div class="mb-2">
							<button id="btn-ads" class="btn btn-secondary me-1">ADS</button>
							<button id="btn-dht" class="btn btn-secondary me-1">DHT22</button>
							<button id="btn-ds18b20" class="btn btn-secondary me-1">DS18B20</button>
							<button id="btn-bh1750" class="btn btn-secondary me-1">BH1750</button>
						</div>
						<pre id="sensorOutput" style="height:auto; overflow:auto; background:#f8f9fa; padding:10px;"></pre>
					</div>
				</div>
			</div>
		</div>
		<!-- main JS (after Chart.js) -->
		<script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
		</main>

  <footer class="lcars-footer">
    Powered by Chilli ¬∑ LCARS theme
  </footer>
	</body>
</html>